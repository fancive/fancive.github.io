---
title: Automating Deployment Pipeline From Code Review to Production
date: 2025-01-30T14:07:06+08:00
lastmod: 2025-01-30T14:07:06+08:00
author: fancivez
# avatar: /img/author.jpg
# authorlink: https://author.site
cover: /images/img/idp.jpg
# images:
#   - images/img/idp.jpg
categories:
  - 软件架构
tags:
  - 开发工具
# nolastmod: true
draft: false
---

## 传统部署流程的痛点
在开发自动化部署工具之前，我们的部署流程需要频繁的人工介入和等待。让我们看看一个典型的部署过程：

1. 评审与合并阶段
开发人员提交代码后，首先要在代码平台等待其他同学评审并给出 +2。这个过程完全依赖人工，评审人可能正在开会或者忙于其他事情，导致评审时间不可控。
<!--more-->

2. 流水线等待阶段
代码合入 feature 分支后，需要等待大约 5 分钟完成流水线检查，包括编译和各类代码检查。这期间开发人员需要时不时刷新页面查看流水线状态。
3. 分支合并阶段
流水线通过后，还需要手动将 feature 分支合入部署分支（如沙盒环境分支）。合入后又要再等待一轮流水线，又是 5 分钟左右的等待和检查时间。
4. 部署准备阶段
接下来是最容易出错的环节：手动处理构建产物 URL。由于只有 master 分支支持构建版本号，开发人员需要手动复制编译产出的 URL，并根据部署需求修改 URL 后缀。这个步骤既繁琐又容易出错。
5. 部署配置阶段
在部署平台上，需要手动选择正确的服务、环境和发布策略，然后填写前面准备好的编译产出 URL。每一个选项都不能出错，否则可能导致部署失败或者部署到错误的环境。
6. 部署执行阶段
部署开始后，还需要持续关注部署状态，在特定阶段点击"继续"按钮。整个过程需要人工监控，无法安心去做其他事情。

## 痛点总结
这个传统的部署流程存在几个明显的问题：
1. 时间成本高：整个过程需要至少 15 分钟，其中大部分是等待时间。
2. 人工介入频繁：需要在不同阶段反复检查状态、手动操作，无法专注于其他工作。
3. 容易出错：特别是在处理构建 URL 和选择部署参数时，手动操作容易出现失误。
4. 体验割裂：需要在多个平台之间切换，体验非常割裂。

## 自动化改造

针对这些痛点，我们的自动化部署工具实现了以下改进：
1. 自动状态跟踪：工具会自动监控评审状态、流水线状态，无需人工刷新查看。
2. 智能分支管理：评审通过后自动完成分支合并，无需手动操作。
3. 自动参数处理：构建 URL 的获取和修改全部自动化，消除人工失误的可能。
4. 一站式操作：整合多平台功能，在一个工具内完成全流程操作。
5. 可视化进度：清晰展示每个阶段的状态和预计剩余时间，让等待过程更加透明。

## 收益

通过自动化改造，我们实现了显著的效率提升：
1. 部署时间从 15 分钟减少到 5 分钟，大大节省了等待时间。
2. 无需人工干预，可以专注于其他工作
3. 完全消除了手动操作导致的错误
4. 标准化的部署流程，降低了新人上手难度
这个工具很好地诠释了"工欲善其事，必先利其器"的理念。通过消除重复的人工操作，不仅提升了团队的开发效率，也让部署过程变得更加可靠和轻松。